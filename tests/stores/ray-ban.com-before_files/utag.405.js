//tealium universal tag - utag.405 ut4.0.202002271534, Copyright 2020 Tealium.com Inc. All Rights Reserved.
!function(){function n(){function n(n){p.level=n}function e(n,e){p.info(n,"event emitted"),e=c(e||{}),e.meta=e.meta||{},e.meta.type=n,u.push(e),r(),v.listeners=f(v.listeners,function(n){return!n.disposed})}function o(n,e,o){function r(){return p.info("Replaying events"),t(function(){s(v.events,function(t){c.disposed||l(n,t.meta.type)&&e.call(o,t)})}),f}function i(){return p.info("Disposing event handler"),c.disposed=!0,f}p.info("Attaching event handler for",n);var c={type:n,callback:e,disposed:!1,context:o||window};v.listeners.push(c);var f={replay:r,dispose:i};return f}function t(n){p.info("Calling event handlers"),a++;try{n()}catch(n){p.error("UV API Error",n.stack)}a--,r()}function r(){if(0===u.length&&p.info("No more events to process"),u.length>0&&a>0&&p.info("Event will be processed later"),u.length>0&&0===a){p.info("Processing event");var n=u.shift();v.events.push(n),t(function(){s(v.listeners,function(e){if(!e.disposed&&l(e.type,n.meta.type))try{e.callback.call(e.context,n)}catch(n){p.error("Error emitting UV event",n.stack)}})})}}function i(n,e,o){var t=v.on(n,function(){e.apply(o||window,arguments),t.dispose()});return t}function s(n,e){for(var o=n.length,t=0;t<o;t++)e(n[t],t)}function c(n){var e={};for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);return e}function l(n,e){return"string"==typeof n?n===e:n.test(e)}function f(n,e){for(var o=n.length,t=[],r=0;r<o;r++)e(n[r])&&t.push(n[r]);return t}var u=[],a=0,p={info:function(){p.level>n.INFO||console&&console.info&&console.info.apply(console,arguments)},error:function(){p.level>n.ERROR||console&&console.error&&console.error.apply(console,arguments)}};n.ALL=0,n.INFO=1,n.ERROR=2,n.OFF=3,n(n.ERROR);var v={on:o,emit:e,once:i,events:[],listeners:[],logLevel:n};return v}"object"==typeof module&&module.exports?module.exports=n:window&&void 0===window.uv&&(window.uv=n())}();try{(function(id,loader){var u={};utag.o[loader].sender[id]=u;if(utag===undefined){utag={};}if(utag.ut===undefined){utag.ut={};}if(utag.ut.loader===undefined){u.loader=function(o){var a,b,c,l;a=document;if(o.type==="iframe"){b=a.createElement("iframe");b.setAttribute("height","1");b.setAttribute("width","1");b.setAttribute("style","display:none");b.setAttribute("src",o.src);}else if(o.type==="img"){utag.DB("Attach img: "+o.src);b=new Image();b.src=o.src;return;}else{b=a.createElement("script");b.language="javascript";b.type="text/javascript";b.async=1;b.charset="utf-8";b.src=o.src;}if(o.id){b.id=o.id;}if(typeof o.cb==="function"){if(b.addEventListener){b.addEventListener("load",function(){o.cb();},false);}else{b.onreadystatechange=function(){if(this.readyState==="complete"||this.readyState==="loaded"){this.onreadystatechange=null;o.cb();}};}}l=o.loc||"head";c=a.getElementsByTagName(l)[0];if(c){utag.DB("Attach to "+l+": "+o.src);if(l==="script"){c.parentNode.insertBefore(b,c);}else{c.appendChild(b);}}};}else{u.loader=utag.ut.loader;}
u.ev={'view':1};u.initialized=false;u.map={"Page_Type":"type","_corder":"transaction_id","_ctotal":"basket_total_value","_ccurrency":"basket_total_currency","User_Id":"user_id","User_Email_MD5":"user_email","_cprod":"product_id","_csku":"product_sku","_ccat":"product_category","Page_Language":"language","Page_Country":"country","_csubtotal":"basket_subtotal_value","_cprodname":"product_name","Products_Price_Array":"product_original_price,product_price","_cquan":"product_quantity","dom.url":"product_url","Tags__VarsCustom1":"product_img","Tags__VarsCustom2":"product_stock","Tags__VarsCustom3":"product_moco"};u.extend=[function(a,b,c,d,e,f,g){if(1){d=b['Page_Type'];if(typeof d=='undefined')return;c=[{'Home':'home'},{'Plp|Clv|Clp|EPlp|CPlp':'category'},{'Search':'search'},{'Pdp':'product'},{'CartPage':'basket'},{'Delivery|Payment|OrderSummary':'checkout'},{'ThankYou':'confirmation'}];var m=false;for(e=0;e<c.length;e++){for(f in c[e]){g=new RegExp(f,'i');if(g.test(d)){b['Page_Type']=c[e][f];m=true};};if(m)break};if(!m)b['Page_Type']='other';}},function(a,b){try{if(1){for(var index in b.Products){b.Tags__VarsCustom1='https:'+b.Products[index].DataSource.imageUrl,b.Tags__VarsCustom2=b.Products[index].DataSource.availabilityData.buyableqty,b.Tags__VarsCustom3=b.Products[index].DataSource.availabilityData.productId}}}catch(e){utag.DB(e)}}];u.send=function(a,b){if(u.ev[a]||u.ev.all!==undefined){var c,d,e,f,i;u.data={"type":"","country":"","language":"","currency":utag_settings('Order_Currency',b),"basket_total_value":"","basket_subtotal_value":"","transaction_id":"","user_id":"","user_email":"","product_id":[],"product_sku":[],"product_name":[],"product_category":[],"product_price":[],"product_original_price":[],"product_quantity":[],"product_url":"","product_img":[],"product_stock":"","product_moco":""};for(c=0;c<u.extend.length;c++){try{d=u.extend[c](a,b);if(d==false)return}catch(e){if(typeof utag_err!='undefined'){utag_err.push({e:'extension error:'+e,s:utag.cfg.path+'utag.'+id+'.js',l:c,t:'ex'})}}};for(d in utag.loader.GV(u.map)){if(b[d]!==undefined&&b[d]!==""){e=u.map[d].split(",");for(f=0;f<e.length;f++){u.data[e[f]]=b[d];}}}
uv.emit('ecView',{type:u.data.type,language:u.data.language,country:u.data.country,currency:u.data.currency});if(u.data.user_id){uv.emit('ecUser',{user:{id:u.data.user_id,email:u.data.user_email}})}
if(u.data.type.match(/product/i)){uv.emit('ecProduct',{product:{productId:u.data.product_id.join(),sku:u.data.product_sku.join(),name:u.data.product_name.join(),categories:[u.data.product_category+" > "+u.data.product_moco],price:{value:parseFloat(u.data.product_price).toFixed(2),currency:u.data.currency},originalPrice:{value:parseFloat(u.data.product_original_price).toFixed(2),currency:u.data.currency},stock:u.data.product_stock,url:u.data.product_url,images:[u.data.product_img]},eventType:'detail'})}
if(u.data.type.match(/confirmation/i)){uv.emit('ecBasketTransactionSummary',{basket:{subtotal:{value:parseFloat(parseFloat(u.data.basket_subtotal_value).toFixed(2)),currency:u.data.currency},total:{value:parseFloat(parseFloat(u.data.basket_total_value).toFixed(2)),currency:u.data.currency}},transaction:{id:u.data.transaction_id}})
for(i=0;i<u.data.product_id.length;i++){uv.emit('ecBasketItemTransaction',{basket:{subtotal:{value:parseFloat(parseFloat(u.data.basket_subtotal_value).toFixed(2)),currency:u.data.currency},total:{value:parseFloat(parseFloat(u.data.basket_total_value).toFixed(2)),currency:u.data.currency}},transaction:{id:u.data.transaction_id},product:{productId:u.data.product_id[i],sku:u.data.product_sku[i],name:u.data.product_name[i],categories:[u.data.product_category[i]],price:{value:parseFloat(parseFloat(u.data.product_price[i]).toFixed(2)),currency:u.data.currency},originalPrice:{value:parseFloat(parseFloat(u.data.product_original_price[i]).toFixed(2)),currency:u.data.currency}},quantity:parseFloat(u.data.product_quantity[i]),subtotal:{value:parseFloat(u.data.product_quantity[i])*parseFloat(parseFloat(u.data.product_price[i]).toFixed(2)),currency:u.data.currency}})}}
if(u.data.type.match(/basket/i)){uv.emit('ecBasketSummary',{basket:{subtotal:{value:parseFloat(parseFloat(u.data.basket_subtotal_value).toFixed(2)),currency:u.data.currency},total:{value:parseFloat(parseFloat(u.data.basket_total_value).toFixed(2)),currency:u.data.currency}}})
for(i=0;i<u.data.product_id.length;i++){uv.emit('ecBasketItem',{basket:{subtotal:{value:parseFloat(parseFloat(u.data.basket_subtotal_value).toFixed(2)),currency:u.data.currency},total:{value:parseFloat(parseFloat(u.data.basket_total_value).toFixed(2)),currency:u.data.currency}},product:{productId:u.data.product_id[i],sku:u.data.product_sku[i],name:u.data.product_name[i],categories:[u.data.product_category[i]],price:{value:parseFloat(parseFloat(u.data.product_price[i]).toFixed(2)),currency:u.data.currency},originalPrice:{value:parseFloat(parseFloat(u.data.product_original_price[i]).toFixed(2)),currency:u.data.currency}},quantity:parseFloat(u.data.product_quantity[i]),subtotal:{value:parseFloat(u.data.product_quantity[i])*parseFloat(parseFloat(u.data.product_price[i]).toFixed(2)),currency:u.data.currency}})}}}};utag.o[loader].loader.LOAD(id);})("405","luxottica.ray-ban");}catch(error){utag.DB(error);}
